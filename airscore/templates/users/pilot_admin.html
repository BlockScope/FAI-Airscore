{% extends "base_admin.html"%}

{% block page_title %}
Pilot Admin
{% endblock %}

{% block head %}
<!-- CSS -->
<link href='/static/css/task.css' rel='stylesheet'>
<link href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css' rel='stylesheet'>
<link href='https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css' rel='stylesheet'>
<!-- JS -->
<script type='text/javascript' src='/static/js/utils.js'></script>
<script type='text/javascript' src='/static/js/microajax.minified.js'></script>
{% endblock %}

{% block back %}
<a href="{{ url_for('user.comp_settings_admin', compid=session.compid)}}" class='btn btn-info' type='button'>
  Back to Competition Settings
</a>
{% endblock %}

{% block header %}
{{session.comp_name}} - Registered Pilots
{% endblock %}

{% block content %}
<p>
  <button class='btn btn-primary ml-4' type='button' data-toggle='collapse' data-target='#collapse1'
          aria-expanded='false' aria-controls='collapse1'>
    Register Pilots
  </button>
</p>
<div class='collapse' id='collapse1'>
  {% if pilotdb %}
  <p>
    <button class='btn btn-primary ml-5' type='button' data-toggle='collapse' data-target='#collapse3'
            aria-expanded='false' aria-controls='collapse3'>
      Internal Pilots
    </button>
  </p>
  <div class='collapse' id='collapse3'>


    <div class='card card-body'>
      <div class='container'>

        <center>
          <h3 class='font-weight-bold'>Register Pilots</h3>
          <div class='row'>
            <div class='col-xs-5'>
              <h4>All pilots</h4>
              <h6>(Name - civl id)</h6>
              <select name='from[]' id='lstview' class='form-control' size='25' multiple='multiple'>
              </select>
            </div>

            <div id='buttons' size='25' class='col-xs-2'>
              <br>
              <br>
              <br>
              <br>
              <br>
              <br>
              <button type='button' id='lstview_undo' class='btn btn-danger btn-block'>undo</button>
              <button type='button' id='lstview_rightAll' class='btn btn-default btn-block'><i
                      class='fa fa-forward'></i></button>
              <button type='button' id='lstview_rightSelected' class='btn btn-default btn-block'><i
                      class='fa fa-chevron-right'></i></button>
              <button type='button' id='lstview_leftSelected' class='btn btn-default btn-block'><i
                      class='fa fa-chevron-left'></i></button>
              <button type='button' id='lstview_leftAll' class='btn btn-default btn-block'><i
                      class='fa fa-backward'></i></button>
              <button type='button' id='lstview_redo' class='btn btn-warning btn-block'>redo</button>
            </div>

            <div class='col-xs-5'>
              <h4 id='registered'>Registered pilots</h4>
              <h6>(Name - civl id)</h6>
              <select name='to[]' id='lstview_to' class='form-control' size='25' multiple='multiple'>

              </select>

            </div>
          </div>
          <button type='button' onclick='register_pilots();' class='btn btn-success'>Save</button>
        </center>

      </div>
    </div>
  </div>

  <p>
    <button class='btn btn-primary ml-5' type='button' data-toggle='collapse' data-target='#collapse4'
            aria-expanded='false' aria-controls='collapse4'>
      External Pilots
    </button>
  </p>
  <div class='collapse' id='collapse4'>
    {% endif %}

    <div class='card card-body'>
      <div class='container'>
        <h4 style='float:left'>Registered {% if pilotdb %}External {% endif %}Pilots:</h4>
        <h4 id='total_external_pilots'></h4>
        <button id='manual_add_pilot_button' class='btn btn-success ml-4' data-toggle='modal' data-target='#add_modal'>
          Add a pilot
        </button>
        <button id='Excel_button' class='btn btn-success ml-4' data-toggle='modal' data-target='#excel_modal'>
          Upload Excel file
        </button>
        <button id='FSDB_button' class='btn btn-success ml-4'>
          Upload FSDB file
        </button>
        <input id='FSDB_fileupload' style='width: 0%;' type='file' size='chars' class='custom-file-input'
               data-url='/users/_upload_participants_fsdb/{{ session.compid }}' name='fsdb_file'>
        <button id='delete_external' data-toggle='modal' data-target='#delete_modal' class='btn btn-danger ml-4'>Remove
          All
        </button>
      </div>
    </div>
  </div>

  {% if pilotdb %}

</div>
{% endif %}
<p>
  <button class='btn btn-primary ml-4' type='button' data-toggle='collapse' data-target='#collapse2'
          aria-expanded='false' aria-controls='collapse2'>
    Registered Pilot Details
  </button>
</p>
<div class='collapse' id='collapse2'>
  <div class='card card-body'>
    <div class='container'>
      <h3 class='font-weight-bold'>Registered Pilot Details</h3>
      <h4 id='total_pilots'></h4>
      <div id='download_section'>
        <button id='download_html' onclick="location.href='/users/_download/participants_html/{{session.compid}}'" class='btn btn-primary ml-4'>HTML list</button>
        <button id='download_fsdb' onclick="location.href='/users/_download/participants_fsdb/{{session.compid}}'" class='btn btn-primary ml-4'>FSDB List</button>
      </div>
      <h6 class='text-danger' id='team_messages'></h6>
      <table id='pilots' class='row-border compact' cellspacing='0' width='100%'>
        <thead>
        <tr>
        </tr>
        </thead>
      </table>
    </div>
  </div>
</div>

<!---edit-participant details modal starts here--->
<div id='edit_par_modal' class='modal fade' role='dialog'>
  <div class='modal-dialog'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h4 class='modal-title'>Update Participant Details</h4>
      </div>
      <div class='modal-body' id='modmodal-body'>
        <div class='form-row'>
          <div class='form-group width6'>
            {{modify_participant_form.id_num.label}} {{modify_participant_form.id_num(size=2,
            **{'id':"mod_id_number",})}}
            {{modify_participant_form.CIVL.label}} {{modify_participant_form.CIVL(size=2, **{'id':"mod_civl",})}}
            {{modify_participant_form.name.label}} {{modify_participant_form.name(**{'id':"mod_name",})}}
          </div>
        </div>
        <div class='form-row'>
          <div class='form-group width12'>
            {{modify_participant_form.nat.label}} {{modify_participant_form.nat(size=4, **{'id':"mod_nat"})}}
            <div id='mod_nat_team_section'>
              {{modify_participant_form.nat_team.label}} {{modify_participant_form.nat_team(size=4,
              **{'id':"mod_nat_team"})}}
            </div>
          </div>
        </div>
        <div class='form-row'>
          <div class='form-group col-md-12'>
            {{modify_participant_form.sex.label}} {{modify_participant_form.sex(**{'id':"mod_sex"})}}
          </div>
        </div>
        <div class='form-row'>
          <div class='form-group col-md-12'>
            {{modify_participant_form.glider.label}} {{modify_participant_form.glider(**{'id':"mod_glider"})}}
            {{modify_participant_form.certification.label}} {{modify_participant_form.certification(size=4,
            **{'id':"mod_certification"})}}
          </div>
          <div class='form-group col-md-12'>
            <div class='form-group col-md-6'>
              {{modify_participant_form.sponsor.label}} {{modify_participant_form.sponsor(size=30,
              **{'id':"mod_sponsor"})}}
            </div>
          </div>
          <div class='form-group col-md-12'>
            <div id='mod_team_section' class='form-group col-md-6'>
              {{modify_participant_form.team.label}} {{modify_participant_form.team(size=30, **{'id':"mod_team"})}}
            </div>
          </div>
          <div class='form-group col-md-12'>
            {{modify_participant_form.status.label}} {{modify_participant_form.status(**{'id':"mod_status"})}}
            {{modify_participant_form.paid.label}} {{modify_participant_form.paid( **{'id':"mod_paid"})}}
          </div>
        </div>
      </div>
      <div class='modal-footer'>
        <button type='button' class='btn btn-danger' data-dismiss='modal'>Cancel</button>
        <button id='modify_confirmed' type='button' class='btn btn-success' data-dismiss='modal'>Save</button>
      </div>
    </div>
  </div>
</div>
<!-edit-participant details-Modal ends here--->

<!---add-participant details modal starts here--->
<div id='add_modal' class='modal fade' role='dialog'>
  <div class='modal-dialog'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h4 class='modal-title'>Add a pilot</h4>
      </div>
      <div class='modal-body' id='addmodal-body'>
        <div class='form-row'>
          <div class='form-group width6'>
            {{modify_participant_form.id_num.label}} {{modify_participant_form.id_num(size=2,
            **{'id':"add_id_number",})}}
            {{modify_participant_form.CIVL.label}} {{modify_participant_form.CIVL(size=2, **{'id':"add_civl",})}}
            {{modify_participant_form.name.label}} {{modify_participant_form.name(**{'id':"add_name",})}}
          </div>
        </div>
        <div class='form-row'>
          <div class='form-group width12'>
            {{modify_participant_form.nat.label}} {{modify_participant_form.nat(size=4, **{'id':"add_nat"})}}
            <div id='add_nat_team_section'>
              {{modify_participant_form.nat_team.label}} {{modify_participant_form.nat_team(size=4,
              **{'id':"add_nat_team"})}}
            </div>
          </div>
        </div>
        <div class='form-row'>
          <div class='form-group col-md-12'>
            {{modify_participant_form.sex.label}} {{modify_participant_form.sex(**{'id':"add_sex"})}}
          </div>
        </div>
        <div class='form-row'>
          <div class='form-group col-md-12 '>
            {{modify_participant_form.glider.label}} {{modify_participant_form.glider(**{'id':"add_glider"})}}
            {{modify_participant_form.certification.label}} {{modify_participant_form.certification(size=4,
            **{'id':"add_certification"})}}
          </div>
          <div class='form-group col-md-12'>
            <div class='form-group col-md-6'>
              {{modify_participant_form.sponsor.label}} {{modify_participant_form.sponsor(size=30,
              **{'id':"add_sponsor"})}}
            </div>
          </div>
          <div class='form-group col-md-12'>
            <div id='add_team_section' class='form-group col-md-6'>
              {{modify_participant_form.team.label}} {{modify_participant_form.team(size=30, **{'id':"add_team"})}}
            </div>
          </div>
          <div class='form-group col-md-12'>
            {{modify_participant_form.status.label}} {{modify_participant_form.status(**{'id':"add_status"})}}
            {{modify_participant_form.paid.label}} {{modify_participant_form.paid( **{'id':"add_paid"})}}
          </div>
        </div>
      </div>
      <div class='modal-footer'>
        <button type='button' class='btn btn-danger' data-dismiss='modal'>Cancel</button>
        <button id='add_confirmed' type='button' class='btn btn-success' onclick='save_new_participant();'
                data-dismiss='modal'>Save
        </button>
      </div>
    </div>
  </div>
</div>
<!-add-participant details-Modal ends here--->

<!-- delete Modal -->
<div id='delete_modal' class='modal fade' role='dialog'>
  <div class='modal-dialog'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h4 class='modal-title'>Please confirm</h4>
      </div>
      <div class='modal-body' id='modal-body'>
        <p>This will remove all the{% if pilotdb %} external{% endif %} pilots from the competition</p>

      </div>
      <div class='modal-footer'>
        <button type='button' class='btn btn-success' data-dismiss='modal'>Cancel</button>
        <button id='delete_confirmed' type='button' onclick='unregister_all_external();' class='btn btn-danger'
                data-dismiss='modal'>Delete
        </button>
      </div>
    </div>
  </div>
</div>
<!-- end delete Modal -->

<!--- upload excel file Modal starts here--->
<div id='excel_modal' class='modal fade' tabindex='-1' role='dialog'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h4 class='modal-title'>Upload Participants Excel File</h4>
      </div>
      <div class='modal-body' id='statusmodal-body'>
        <div class='container-fluid'>
          <div class='col-md-12'>
            <p><strong>The excel file has to be in standard AirTribune format.</strong></p>
            <a class="btn btn-primary mt-2 mb-2" href="/download/file/participants_template.xlsx">Download Template File</a>
            <ul class="list-group">
              <li class="list-group-item">id: Pilot ID</li>
              <li class="list-group-item">name: Pilot name</li>
              <li class="list-group-item">nat: Country code</li>
              <li class="list-group-item">female: 1 if female</li>
              <li class="list-group-item">birthday: format dd.mm.yyyy</li>
              <li class="list-group-item">glider, color, sponsor: glider name and color, sponsor</li>
              <li class="list-group-item">fai_licence: 1 if valid</li>
              <li class="list-group-item">CIVLID: numeric, pilot's CIVL id</li>
              <li class="list-group-item">club, team: pilot's club and team</li>
              <li class="list-group-item">class: glider certification, used in rankings</li>
              <li class="list-group-item">Live: If using Flymaster livetracking, 'Live' column should contain pilots tracker id.</li>
            </ul>
          </div>
        </div>
        <div class='modal-footer'>
          <button type='button' class='btn btn-secondary' data-dismiss='modal'>Cancel</button>
          <button id='upload_excel_button' class='btn btn-success ml-4' data-dismiss="modal">Upload Excel file</button>
          <input id='Excel_fileupload' style='width: 0%;' type='file' size='chars' class='custom-file-input'
               data-url='/users/_upload_participants_excel/{{ session.compid }}' name='excel_file'>
        </div>
      </div>
    </div>
  </div>
</div>
<!--- upload excel file Modal ends here--->

{% endblock %}

{% block js %}
<script type='text/javascript' src='https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js'></script>
<script src="{{ static_url_for('static', filename='js/multiselect.min.js') }}"></script>
<script src="{{ static_url_for('static', filename='js/pop_registered_pilots_admin.js') }}"></script>
<script src="{{ static_url_for('static', filename='js/jquery-file-upload/jquery.ui.widget.js') }}"></script>
<script src="{{ static_url_for('static', filename='js/jquery-file-upload/jquery.iframe-transport.js') }}"></script>
<script src="{{ static_url_for('static', filename='js/jquery-file-upload/jquery.fileupload.js') }}"></script>
<script src="{{ static_url_for('static', filename='js/pilot_admin.js') }}"></script>
<script type='text/javascript'>
var pilotdb = {{ pilotdb|tojson }};
var compid = {{ session.compid|tojson }};
var unregister_participant_url = "{{ url_for('user._unregister_participant', compid=session.compid) }}";
var check_team_size_url = "{{ url_for('user._check_team_size', compid=session.compid) }}";
var check_nat_team_size_url = "{{ url_for('user._check_nat_team_size', compid=session.compid) }}";
var get_non_and_registered_pilots_internal_url = "{{ url_for('user._get_non_and_registered_pilots_internal', compid=session.compid) }}";
var register_pilots_url = "{{ url_for('user._register_pilots', compid=session.compid) }}";
var unregister_all_external_participants_url = "{{ url_for('user._unregister_all_external_participants', compid=session.compid) }}";
var register_pilots_url = "{{ url_for('user._register_pilots', compid=session.compid) }}";
</script>
{% endblock %}