{% extends "base.html"%}

{% block content %}
<!-- <script src="https://rawgit.com/DashboardCode/BsMultiSelect/master/dist/js/BsMultiSelect.min.js"></script> -->
<script src="/static/js/BsMultiSelect.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css"
   integrity="sha512-wcw6ts8Anuw10Mzh9Ytw4pylW8+NAD4ch3lqm9lzAsTxg0GFeJgoAtxuCLREZSC5lUXdVyo/7yfsqFjQ4S+aKw=="
   crossorigin=""/>
   <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js"
      integrity="sha512-mNqn2Wg7tSToJhvHcqfzLMU6J4mkOImSPTxVZAdo+lcPlk+GhZmYgACEe0x35K7YzW1zJ7XyJV/TT1MrdXvMcA=="
      crossorigin=""></script>


<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<!--<script src="/static/leaflet.elevation-0.0.4.js" crossorigin="anonymous"></script>-->
<link rel="stylesheet" href="/static/css/BsMultiSelect.css" crossorigin="anonymous">

<h1>Airspace: {{file}}</h1>
<div id="map">
{{map|safe}}
</div>

<div  id ="message" class="jumbotron">
    <h3>Note:</h3>
    <p class="lead">Airscore uses meters above mean sea level in checking flights.
      All heights in feet will be converted automatically, however if the airspace contains AGL
      you may want to increase the altitude in the table below. You can adjust the floor and ceiling columns.
      Use the format "XXXX ft" or "XXXX m". You can also delete airspaces if not needed.
      Clicking save will create a new Openair file.
      The new file will be available to immediately download here and for pilots, from the competition page.</p>
  <b/><h2 class = "text-danger"><b>{{message}}</b></h2>
    <h6 class = "text-danger">{{FL_message}}</h6>
</div>

<div class="container">
  <table class="table table-striped " id="airspace_table">
    <thead>
      <tr>
        <th scope="col">Name</th>
        <th scope="col">Class</th>
        <th scope="col">Floor</th>
        <th scope="col">Ceiling</th>
        <th scope="col">Floor (checking) (m a.s.l.)</th>
        <th scope="col">Ceiling (checking) (m a.s.l.)</th>
      </tr>
    </thead>
    <tbody id=airspace_table_body>

      {%for a in airspace_list %}
        <tr>
          <td data-editable="false">{{a['name']}}</td>
          <td data-editable="false">{{a['class']}}</td>
          {% if a['floor unit'] == 'FL' or a['floor unit'] == "Unknown height unit"  %}
            <td class="text-danger"> {{a['floor description']}}</td>
          {% else %}
            <td>{{a['floor description']}}</td>
          {% endif %}

          {% if a['ceiling unit'] == 'FL' or a['ceiling unit'] == "Unknown height unit"  %}
            <td class="text-danger"> {{a['ceiling description']}}</td>
          {% else %}
            <td>{{a['ceiling description']}}</td>
           {% endif %}

          <td data-editable="false">{{a['floor']}}</td>
          <td data-editable="false">{{a['ceiling']}}</td>
          <td data-editable="false"><button type="button" class="btn btn-primary" id="delete_airspace_{{a['id']}}" onclick=" delete_space({{loop.index0}});">Delete</button></td>
        </tr>
      {% endfor %}

    </tbody>
  </table>
</div>

<form action="/" method="post">
    <div class="container">
        <button type="button" class="btn btn-primary" id="submit-tracks">Save new file</button>
    </div>
</form>

<script src="/static/js/mindmup-editabletable.js"></script>
<script>
	$('#airspace_table').editableTableWidget();
</script>
<script>delete_airspace_list = {{delete_list|safe}};</script>

<script>

function delete_space(index){
  $('#delete_airspace_' + index).closest('tr').toggleClass("text-muted bg-dark ");
  if (delete_airspace_list[index].delete == false) {
    $('#delete_airspace_' + index).text("Reinstate");
    delete_airspace_list[index].delete = true;
      }
    else {
        $('#delete_airspace_' + index).text("Delete");
    delete_airspace_list[index].delete = false;
    }

  };



<!--  tracks=[]-->
<!--  $(document).ready(function() {-->
<!--    $("#submit-tracks").click(function(){-->
<!--        tracks = $('#select-tracks-id').val();-->
<!--        if(tracks.length > 0){-->
<!--          fetch('/_map/9999/' + tracks).then(function(response) {-->
<!--                          response.text().then(function(data) {-->

<!--                         map.innerHTML = data;-->
<!--                       })-->

<!--                   });-->
<!--        }-->
<!--        else {-->
<!--    $(location).attr('href','/map/9999');-->

<!--        }-->
<!--    });-->
<!--});-->
</script>




{% endblock %}
