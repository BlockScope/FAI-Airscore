{% extends "layout.html" %}
{% block content %}

  <body>
<!--  <head>-->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Track Management</title>

    <!-- CSS -->
    <link href="/static/css/task.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" rel="stylesheet">
    <script src="{{ static_url_for('static', filename='js/utils.js') }}"></script>


    <div class="container" id="main">
    <br>
    <table id="tracks" class="row-border stripe compact mb-1" cellspacing="0" width="100%">
    <thead>
        <tr>
            <th>Name</th>
            <th>Status</th>
            <th>Result</th>
            <th></th>
        </tr>
    </thead>
    </table>
    </div>


</body>

{% endblock %}

{% block js %}
{% include "js.html" %}
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="{{ static_url_for('static', filename='js/pop_track_admin.js') }}"></script>
    <script type="text/javascript">populate_track_admin({{taskid|tojson}})</script>
    <script type="text/javascript">


        function set_result(par_id, status){
               var mydata = new Object();
               mydata.par_id = par_id;
               mydata.Result = status;

   $.ajax({
               type: "POST",
               url: "{{ url_for('user._set_result', taskid=taskid)}}",
               contentType:"application/json",
               data : JSON.stringify(mydata),
               dataType: "json",
               success: function (response, par_id) {
                      update_row(response);
               }
               });
}

        function update_row(new_data){
        var table = $('#tracks').dataTable();
        new_data.Name = $('#tracks').DataTable().row( $('tr#id_'+ new_data.par_id)).data()['Name'];
        table.fnUpdate(new_data, $('tr#id_'+ new_data.par_id), undefined, false);
        }

   function delete_track(track_id, par_id){
               var mydata = new Object();
               mydata.track_id = track_id
               mydata.par_id = par_id;
   $.ajax({
               type: "POST",
               url: "/users/_delete_track/" + track_id,
               contentType:"application/json",
               data : JSON.stringify(mydata),
               dataType: "json",
               success: function (response, par_id) {
                      update_row(response);
               }
               });
}


    </script>





{% endblock %}
